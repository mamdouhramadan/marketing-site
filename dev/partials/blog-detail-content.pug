//- Blog detail main content. Expects isArabic, blogs from page.
- if (typeof isArabic === 'undefined') isArabic = false
section(class="bg-page dark:bg-gray-900 py-16 md:py-20")
  div(class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8")
    div(class="lg:flex lg:gap-10 lg:items-start")
      div(class="lg:flex-1 min-w-0")
        div#blog-main
          div#blog-main-inner(class="space-y-6")
            div#blog-image(class="rounded-xl overflow-hidden border border-gray-200 dark:border-gray-700 aspect-video bg-gray-100 dark:bg-gray-800")
            h1#blog-title(class="text-secondary dark:text-gray-100 font-bold text-2xl md:text-3xl")
            div#blog-meta(class="flex flex-wrap items-center gap-x-4 gap-y-1 text-sm text-gray-500 dark:text-gray-400")
              span#blog-date
              span ·
              span#blog-author
              span ·
              span#blog-category(class="text-primary font-medium")
            div#blog-content(class="max-w-none mt-6 text-gray-700 dark:text-gray-300")
              p= isArabic ? 'جاري التحميل…' : 'Loading…'
          div(id="blog-comments-section" class="bg-gray-50 dark:bg-gray-800 rounded-xl p-6 mt-12 border-t border-gray-200 dark:border-gray-700")
            h2(class="text-secondary dark:text-gray-100 font-bold text-xl mb-6")= isArabic ? 'التعليقات' : 'Comments'
            div#blog-comments(class="space-y-6")
            div(class="mt-8")
              h3(class="text-lg font-semibold text-secondary dark:text-gray-100 mb-3")= isArabic ? 'أضف تعليقاً' : 'Add a comment'
              form#comment-form(class="flex flex-col gap-3" action="#" method="post")
                input(type="text" name="author" placeholder=isArabic ? 'اسمك' : 'Your name' required class="rounded-md border border-gray-200 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 px-3 py-2 focus:ring-2 focus:ring-primary outline-none")
                textarea(name="text" rows="3" placeholder=isArabic ? 'تعليقك...' : 'Your comment...' required class="rounded-md border border-gray-200 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 px-3 py-2 focus:ring-2 focus:ring-primary outline-none resize-y")
                button(type="submit" class="w-full sm:w-auto px-6 py-2.5 rounded-md bg-primary text-white font-semibold hover:bg-secondary transition")= isArabic ? 'إرسال' : 'Submit'
          nav#blog-nav(aria-label=isArabic ? 'المقال السابق والتالي' : 'Previous and next post' class="bg-gray-50 dark:bg-gray-800 rounded-xl p-6 mt-12 border-t border-gray-200 dark:border-gray-700 flex flex-col sm:flex-row gap-4 justify-between")
            div#blog-prev-wrap(class="flex-1 hover:text-primary/80 dark:hover:text-gray-300/80 transition-colors")
            div#blog-next-wrap(class="flex-1 sm:text-right hover:text-primary/80 dark:hover:text-gray-300/80 transition-colors")

      aside(class="lg:w-80 flex-shrink-0 mt-10 lg:mt-0 lg:sticky lg:top-24")
        div(class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6")
          h2(class="text-secondary dark:text-gray-100 font-bold text-lg mb-4")= isArabic ? 'مقالات ذات صلة' : 'Related posts'
          div#blog-related(class="space-y-4")

script.
  window.__BLOGS__ = !{JSON.stringify(blogs)};
  window.__BLOG_DETAIL_STRINGS__ = !{JSON.stringify({ loading: isArabic ? 'جاري التحميل…' : 'Loading…', noContent: isArabic ? 'لا محتوى.' : 'No content.', noComments: isArabic ? 'لا تعليقات بعد. كن أول من يعلق.' : 'No comments yet. Be the first to comment.', noRelated: isArabic ? 'لا مقالات ذات صلة.' : 'No related posts.', previous: isArabic ? 'السابق' : 'Previous', next: isArabic ? 'التالي' : 'Next', commentSubmitted: isArabic ? 'تم إرسال التعليق (تجريبي).' : 'Comment submitted (demo).' })};
  window.__BLOG_DETAIL_BASE__ = !{JSON.stringify(isArabic ? 'blog-detail-ar.html' : 'blog-detail.html')};
  window.__BLOG_DETAIL_SITE__ = !{JSON.stringify(isArabic ? 'ترافلا' : 'Trufla')};
script.
  (function() {
    var BLOGS = window.__BLOGS__ || [];
    var STRINGS = window.__BLOG_DETAIL_STRINGS__ || {};
    var BASE = window.__BLOG_DETAIL_BASE__ || 'blog-detail.html';
    var SITE = window.__BLOG_DETAIL_SITE__ || 'Trufla';
    var params = new URLSearchParams(window.location.search);
    var id = parseInt(params.get('id'), 10);
    var current = BLOGS.find(function(b) { return b.id === id; }) || BLOGS[0];
    var currentIndex = BLOGS.indexOf(current);

    var related = BLOGS.filter(function(b) { return b.category === current.category && b.id !== current.id; }).slice(0, 4);
    var prevBlog = currentIndex > 0 ? BLOGS[currentIndex - 1] : null;
    var nextBlog = currentIndex >= 0 && currentIndex < BLOGS.length - 1 ? BLOGS[currentIndex + 1] : null;

    var imgEl = document.getElementById('blog-image');
    var titleEl = document.getElementById('blog-title');
    var dateEl = document.getElementById('blog-date');
    var authorEl = document.getElementById('blog-author');
    var catEl = document.getElementById('blog-category');
    var contentEl = document.getElementById('blog-content');
    if (imgEl) {
      imgEl.innerHTML = '';
      var im = document.createElement('img');
      im.src = current.image || '';
      im.alt = current.title || '';
      im.className = 'w-full h-full object-cover';
      imgEl.appendChild(im);
    }
    if (titleEl) titleEl.textContent = current.title || '';
    if (dateEl) dateEl.textContent = current.date || '';
    if (authorEl) authorEl.textContent = current.author || '';
    if (catEl) catEl.textContent = current.category || '';
    if (contentEl) contentEl.innerHTML = current.content || '<p>' + (STRINGS.noContent || 'No content.') + '</p>';

    var t = document.querySelector('title');
    if (t) t.textContent = (current.title || 'Blog') + ' | ' + SITE;
    var bc = document.querySelector('[aria-current="page"]');
    if (bc) bc.textContent = current.title || 'Post';

    var commentsEl = document.getElementById('blog-comments');
    var comments = current.comments || [];
    if (commentsEl) {
      commentsEl.innerHTML = comments.length ? comments.map(function(c) {
        return '<div class="flex gap-3"><div class="flex-shrink-0 w-10 h-10 rounded-full bg-primary/20 text-primary flex items-center justify-center"><span class="fa fa-user"></span></div><div><p class="font-medium text-secondary dark:text-gray-100">' + (c.author || '') + '</p><p class="text-sm text-gray-500 dark:text-gray-400">' + (c.date || '') + '</p><p class="text-gray-700 dark:text-gray-300 mt-1">' + (c.text || '') + '</p></div></div>';
      }).join('') : '<p class="text-gray-500 dark:text-gray-400">' + (STRINGS.noComments || 'No comments yet. Be the first to comment.') + '</p>';
    }
    var form = document.getElementById('comment-form');
    if (form) form.addEventListener('submit', function(e) { e.preventDefault(); alert(STRINGS.commentSubmitted || 'Comment submitted (demo).'); });

    var relatedEl = document.getElementById('blog-related');
    if (relatedEl) {
      relatedEl.innerHTML = related.length ? related.map(function(b) {
        return '<a href="' + BASE + '?id=' + b.id + '" class="block group"><div class="flex gap-3"><img src="' + (b.image || '') + '" alt="" class="w-20 h-14 rounded object-cover flex-shrink-0"/><div class="min-w-0"><p class="font-medium text-secondary dark:text-gray-100 line-clamp-2 group-hover:text-primary">' + (b.title || '') + '</p><p class="text-sm text-gray-500 dark:text-gray-400">' + (b.date || '') + '</p></div></div></a>';
      }).join('') : '<p class="text-gray-500 dark:text-gray-400">' + (STRINGS.noRelated || 'No related posts.') + '</p>';
    }

    var prevWrap = document.getElementById('blog-prev-wrap');
    var nextWrap = document.getElementById('blog-next-wrap');
    if (prevWrap) prevWrap.innerHTML = prevBlog ? '<a href="' + BASE + '?id=' + prevBlog.id + '" class="inline-flex items-center gap-2 text-primary font-medium hover:text-secondary dark:hover:text-gray-300/80"><span class="fa fa-arrow-left"></span> ' + (prevBlog.title || (STRINGS.previous || 'Previous')) + '</a>' : '';
    if (nextWrap) nextWrap.innerHTML = nextBlog ? '<a href="' + BASE + '?id=' + nextBlog.id + '" class="inline-flex items-center gap-2 text-primary font-medium hover:text-secondary dark:hover:text-gray-300/80">' + (nextBlog.title || (STRINGS.next || 'Next')) + ' <span class="fa fa-arrow-right"></span></a>' : '';
  })();
